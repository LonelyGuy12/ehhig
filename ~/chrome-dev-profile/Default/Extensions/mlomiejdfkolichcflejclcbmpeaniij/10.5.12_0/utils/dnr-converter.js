const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["npm/@ghostery/urlfilter2dnr/dist/esm/converters/adguard.js","virtual/preload-helper.js","npm/@adguard/tsurlfilter/dist/es/declarative-converter.js","npm/@adguard/tsurlfilter/npm/zod/lib/index.js","npm/zod-validation-error/v3/index.js","npm/zod/v3/ZodError.js","npm/zod/v3/helpers/util.js","npm/tldts/dist/es6/index.js","npm/tldts-core/dist/es6/src/factory.js","npm/tldts-core/dist/es6/src/domain.js","npm/tldts-core/dist/es6/src/domain-without-suffix.js","npm/tldts-core/dist/es6/src/extract-hostname.js","npm/tldts-core/dist/es6/src/is-ip.js","npm/tldts-core/dist/es6/src/is-valid.js","npm/tldts-core/dist/es6/src/options.js","npm/tldts-core/dist/es6/src/subdomain.js","npm/tldts/dist/es6/src/suffix-trie.js","npm/tldts-core/dist/es6/src/lookup/fast-path.js","npm/tldts/dist/es6/src/data/trie.js","npm/@adguard/logger/dist/es/index.js","npm/@adguard/scriptlets/dist/validators/index.js","npm/@adguard/agtree/dist/compatibility-tables/redirects.js","npm/@adguard/agtree/dist/compatibility-tables/base.js","npm/@adguard/agtree/dist/compatibility-tables/platforms.js","npm/@adguard/agtree/dist/utils/type-guards.js","npm/@adguard/agtree/dist/compatibility-tables/utils/platform-helpers.js","npm/@adguard/agtree/dist/utils/adblockers.js","npm/@adguard/agtree/dist/compatibility-tables/compatibility-table-data.js","npm/@adguard/agtree/dist/utils/deep-freeze.js","npm/@adguard/agtree/dist/utils/constants.js","npm/@adguard/agtree/dist/compatibility-tables/utils/resource-type-helpers.js","npm/@adguard/agtree/dist/compatibility-tables/modifiers.js","npm/@adguard/agtree/dist/compatibility-tables/schemas/resource-type.js","npm/@adguard/agtree/npm/zod/lib/index.js","virtual/index.js","virtual/_commonjsHelpers.js","npm/is-cidr/index.js","virtual/index3.js","npm/is-cidr/npm/cidr-regex/index.js","virtual/index5.js","npm/is-cidr/npm/ip-regex/index.js","virtual/index2.js","npm/is-ip/index.js","npm/is-ip/npm/ip-regex/index.js","npm/cidr-tools/index.js","npm/ip-regex/index.js","npm/cidr-regex/index.js","npm/ip-bigint/index.js","npm/@adguard/css-tokenizer/dist/csstokenizer.js","virtual/punycode.js","npm/punycode/punycode.js","npm/@adguard/scriptlets/dist/redirects/index.js","virtual/index4.js","npm/js-yaml/index.js","npm/js-yaml/lib/js-yaml.js","virtual/js-yaml.js","npm/js-yaml/lib/js-yaml/loader.js","virtual/loader.js","npm/js-yaml/lib/js-yaml/common.js","virtual/common.js","npm/js-yaml/lib/js-yaml/exception.js","npm/js-yaml/lib/js-yaml/mark.js","npm/js-yaml/lib/js-yaml/schema/default_safe.js","npm/js-yaml/lib/js-yaml/schema.js","npm/js-yaml/lib/js-yaml/type.js","npm/js-yaml/lib/js-yaml/schema/core.js","npm/js-yaml/lib/js-yaml/schema/json.js","npm/js-yaml/lib/js-yaml/schema/failsafe.js","npm/js-yaml/lib/js-yaml/type/str.js","npm/js-yaml/lib/js-yaml/type/seq.js","npm/js-yaml/lib/js-yaml/type/map.js","npm/js-yaml/lib/js-yaml/type/null.js","npm/js-yaml/lib/js-yaml/type/bool.js","npm/js-yaml/lib/js-yaml/type/int.js","npm/js-yaml/lib/js-yaml/type/float.js","npm/js-yaml/lib/js-yaml/type/timestamp.js","npm/js-yaml/lib/js-yaml/type/merge.js","npm/js-yaml/lib/js-yaml/type/binary.js","virtual/_commonjs-dynamic-modules.js","npm/js-yaml/lib/js-yaml/type/omap.js","npm/js-yaml/lib/js-yaml/type/pairs.js","npm/js-yaml/lib/js-yaml/type/set.js","npm/js-yaml/lib/js-yaml/schema/default_full.js","npm/js-yaml/lib/js-yaml/type/js/undefined.js","npm/js-yaml/lib/js-yaml/type/js/regexp.js","npm/js-yaml/lib/js-yaml/type/js/function.js","npm/js-yaml/lib/js-yaml/dumper.js","virtual/dumper.js","npm/@adguard/agtree/dist/parser/rule-parser.js","npm/@adguard/agtree/dist/parser/comment/comment-parser.js","npm/@adguard/agtree/dist/parser/comment/agent-comment-parser.js","npm/@adguard/agtree/dist/utils/string.js","npm/@adguard/agtree/dist/nodes/index.js","npm/@adguard/agtree/dist/parser/comment/agent-parser.js","npm/@adguard/agtree/dist/errors/adblock-syntax-error.js","npm/@adguard/agtree/dist/parser/base-parser.js","npm/@adguard/agtree/dist/errors/not-implemented-error.js","npm/@adguard/agtree/dist/parser/options.js","npm/@adguard/agtree/dist/parser/misc/value-parser.js","npm/@adguard/agtree/dist/common/agent-common.js","npm/@adguard/agtree/dist/utils/cosmetic-rule-separator.js","npm/@adguard/agtree/dist/parser/comment/config-comment-parser.js","npm/json5/dist/index.js","npm/@adguard/agtree/dist/parser/misc/parameter-list-parser.js","npm/@adguard/agtree/dist/parser/comment/hint-comment-parser.js","npm/@adguard/agtree/dist/parser/comment/hint-parser.js","npm/@adguard/agtree/dist/parser/comment/metadata-comment-parser.js","npm/@adguard/agtree/dist/parser/comment/preprocessor-parser.js","npm/@adguard/agtree/dist/parser/misc/logical-expression-parser.js","npm/@adguard/agtree/dist/parser/comment/simple-comment-parser.js","npm/@adguard/agtree/dist/parser/cosmetic/cosmetic-rule-parser.js","virtual/sprintf.js","npm/sprintf-js/src/sprintf.js","virtual/sprintf2.js","npm/@adguard/agtree/dist/parser/misc/domain-list-parser.js","npm/@adguard/agtree/dist/parser/misc/list-items-parser.js","npm/@adguard/agtree/dist/parser/misc/modifier-list.js","npm/@adguard/agtree/dist/parser/misc/modifier-parser.js","npm/@adguard/agtree/dist/parser/css/ubo-selector-parser.js","npm/@adguard/agtree/dist/parser/css/balancing.js","npm/@adguard/agtree/dist/parser/css/constants.js","npm/@adguard/agtree/dist/common/ubo-selector-common.js","npm/@adguard/agtree/dist/parser/css/adg-css-injection-parser.js","npm/@adguard/agtree/dist/parser/css/css-token-stream.js","npm/@adguard/agtree/dist/converter/data/css.js","npm/@adguard/agtree/dist/parser/cosmetic/body/abp-snippet-injection-body-parser.js","npm/@adguard/agtree/dist/common/abp-snippet-injection-body-common.js","npm/@adguard/agtree/dist/parser/cosmetic/body/ubo-scriptlet-injection-body-parser.js","npm/@adguard/agtree/dist/parser/misc/ubo-parameter-list-parser.js","npm/@adguard/agtree/dist/utils/quotes.js","npm/@adguard/agtree/dist/parser/cosmetic/body/adg-scriptlet-injection-body-parser.js","npm/@adguard/agtree/dist/parser/network/network-rule-parser.js","npm/@adguard/agtree/dist/parser/network/host-rule-parser.js","npm/@adguard/agtree/dist/generator/rule-generator.js","npm/@adguard/agtree/dist/generator/base-generator.js","npm/@adguard/agtree/dist/generator/comment/comment-rule-generator.js","npm/@adguard/agtree/dist/generator/comment/agent-comment-generator.js","npm/@adguard/agtree/dist/generator/comment/agent-generator.js","npm/@adguard/agtree/dist/generator/comment/hint-comment-generator.js","npm/@adguard/agtree/dist/generator/comment/hint-generator.js","npm/@adguard/agtree/dist/generator/misc/parameter-list-generator.js","npm/@adguard/agtree/dist/generator/misc/value-generator.js","npm/@adguard/agtree/dist/generator/comment/pre-processor-comment-generator.js","npm/@adguard/agtree/dist/generator/misc/logical-expression-generator.js","npm/@adguard/agtree/dist/generator/comment/metadata-comment-generator.js","npm/@adguard/agtree/dist/generator/comment/config-comment-generator.js","npm/@adguard/agtree/dist/generator/comment/simple-comment-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/cosmetic-rule-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/cosmetic-rule-pattern-generator.js","npm/@adguard/agtree/dist/generator/misc/modifier-list-generator.js","npm/@adguard/agtree/dist/generator/misc/modifier-generator.js","npm/@adguard/agtree/dist/generator/misc/domain-list-generator.js","npm/@adguard/agtree/dist/generator/misc/list-items-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/cosmetic-rule-body-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/body/adg-scriptlet-injection-body-generator.js","npm/@adguard/agtree/dist/generator/css/adg-css-injection-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/body/abp-snippet-injection-body-generator.js","npm/@adguard/agtree/dist/generator/cosmetic/body/ubo-scriptlet-injection-body-generator.js","npm/@adguard/agtree/dist/generator/network/host-rule-generator.js","npm/@adguard/agtree/dist/generator/network/network-rule-generator.js","npm/@adguard/agtree/dist/utils/input-byte-buffer.js","npm/@adguard/agtree/dist/utils/byte-buffer.js","npm/@adguard/agtree/dist/utils/is-chromium.js","npm/@adguard/agtree/dist/utils/text-decoder-polyfill.js","npm/@adguard/agtree/dist/utils/binary-schema-version.js","npm/@adguard/agtree/dist/errors/binary-schema-mismatch-error.js","npm/@adguard/agtree/dist/converter/rule.js","npm/@adguard/agtree/dist/converter/comment/index.js","npm/@adguard/agtree/dist/converter/base-interfaces/rule-converter-base.js","npm/@adguard/agtree/dist/converter/base-interfaces/base-converter.js","npm/@adguard/agtree/dist/utils/clone.js","virtual/index6.js","npm/clone-deep/index.js","npm/shallow-clone/index.js","npm/kind-of/index.js","npm/is-plain-object/index.js","npm/isobject/index.js","npm/@adguard/agtree/dist/converter/base-interfaces/conversion-result.js","npm/@adguard/agtree/dist/converter/cosmetic/index.js","npm/@adguard/agtree/dist/converter/cosmetic/html.js","npm/@adguard/agtree/dist/errors/rule-conversion-error.js","npm/@adguard/agtree/dist/utils/regexp.js","npm/@adguard/agtree/dist/ast-utils/clone.js","npm/@adguard/agtree/dist/converter/cosmetic/scriptlet.js","npm/@adguard/agtree/dist/ast-utils/scriptlets.js","npm/@adguard/agtree/dist/compatibility-tables/scriptlets.js","npm/@adguard/agtree/dist/converter/cosmetic/rule-modifiers/adg.js","npm/@adguard/agtree/dist/ast-utils/modifiers.js","npm/@adguard/agtree/dist/utils/multi-value-map.js","npm/@adguard/agtree/dist/converter/cosmetic/css.js","npm/@adguard/agtree/dist/converter/css/index.js","npm/@adguard/agtree/dist/converter/cosmetic/element-hiding.js","npm/@adguard/agtree/dist/converter/cosmetic/header-removal.js","npm/@adguard/agtree/dist/ast-utils/network-rules.js","npm/@adguard/agtree/dist/converter/cosmetic/rule-modifiers/ubo.js","npm/@adguard/agtree/dist/converter/network/index.js","npm/@adguard/agtree/dist/converter/misc/network-rule-modifier.js","npm/@adguard/agtree/dist/deserializer/rule-deserializer.js","npm/@adguard/agtree/dist/deserializer/base-deserializer.js","npm/@adguard/agtree/dist/deserializer/comment/comment-rule-deserializer.js","npm/@adguard/agtree/dist/deserializer/comment/agent-comment-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/agent-comment-common.js","npm/@adguard/agtree/dist/deserializer/comment/agent-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/agent-common.js","npm/@adguard/agtree/dist/deserializer/misc/value-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/value-common.js","npm/@adguard/agtree/dist/marshalling-utils/misc/binary-type-common.js","npm/@adguard/agtree/dist/deserializer/comment/config-comment-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/config-comment-common.js","npm/@adguard/agtree/dist/deserializer/misc/parameter-list-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/parameter-list-common.js","npm/@adguard/agtree/dist/deserializer/comment/hint-comment-deserializer.js","npm/@adguard/agtree/dist/deserializer/comment/hint-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/hint-common.js","npm/@adguard/agtree/dist/marshalling-utils/comment/hint-comment-common.js","npm/@adguard/agtree/dist/deserializer/syntax-deserialization-map.js","npm/@adguard/agtree/dist/marshalling-utils/syntax-serialization-map.js","npm/@adguard/agtree/dist/deserializer/comment/metadata-comment-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/metadata-comment-common.js","npm/@adguard/agtree/dist/deserializer/comment/pre-processor-comment-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/pre-processor-comment-common.js","npm/@adguard/agtree/dist/deserializer/misc/logical-expression-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/logical-expression-common.js","npm/@adguard/agtree/dist/serializer/misc/logical-expression-serializer.js","npm/@adguard/agtree/dist/serializer/base-serializer.js","npm/@adguard/agtree/dist/deserializer/comment/simple-comment-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/comment/simple-comment-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/cosmetic-rule-deserializer.js","npm/@adguard/agtree/dist/deserializer/misc/domain-list-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/domain-list-common.js","npm/@adguard/agtree/dist/deserializer/misc/list-items-deserializer.js","npm/@adguard/agtree/dist/deserializer/misc/list-item-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/list-item-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/scriptlet-body/abp-snippet-injection-body-deserializer.js","npm/@adguard/agtree/dist/deserializer/cosmetic/scriptlet-body/scriptlet-body-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/body/abp-snippet-injection-body-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/scriptlet-body/ubo-scriptlet-injection-body-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/body/ubo-scriptlet-injection-body-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/scriptlet-body/adg-scriptlet-injection-body-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/body/adg-scriptlet-injection-body-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/element-hiding-body-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/body/element-hiding-body-common.js","npm/@adguard/agtree/dist/deserializer/cosmetic/css-injection-body-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/body/css-injection-body-common.js","npm/@adguard/agtree/dist/deserializer/misc/modifier-list-deserializer.js","npm/@adguard/agtree/dist/deserializer/misc/modifier-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/modifier-common.js","npm/@adguard/agtree/dist/marshalling-utils/misc/modifier-list-common.js","npm/@adguard/agtree/dist/marshalling-utils/cosmetic/cosmetic-rule-common.js","npm/@adguard/agtree/dist/deserializer/network/host-rule-deserializer.js","npm/@adguard/agtree/dist/deserializer/network/hostname-list-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/misc/hostname-list-common.js","npm/@adguard/agtree/dist/marshalling-utils/misc/host-rule-common.js","npm/@adguard/agtree/dist/deserializer/network/network-rule-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/network/network-rule-common.js","npm/@adguard/agtree/dist/deserializer/empty-rule-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/empty-rule-common.js","npm/@adguard/agtree/dist/deserializer/invalid-rule-deserializer.js","npm/@adguard/agtree/dist/deserializer/invalid-rule-error-node-deserializer.js","npm/@adguard/agtree/dist/marshalling-utils/invalid-rule-error-node-common.js","npm/@adguard/agtree/dist/marshalling-utils/invalid-rule-common.js","npm/@adguard/agtree/dist/utils/domain.js","npm/@adguard/scriptlets/dist/scriptlets/index.js","npm/@adguard/tsurlfilter/dist/es/index.js","npm/@adguard/tsurlfilter/dist/es/simple-regex-Dw3J24Ss.js","npm/@adguard/tsurlfilter/dist/es/network-rule-options.js","npm/@adguard/tsurlfilter/dist/es/request-type.js","npm/@adguard/agtree/dist/utils/output-byte-buffer.js","npm/@adguard/agtree/dist/utils/text-encoder-polyfill.js","npm/@adguard/agtree/dist/serializer/rule-serializer.js","npm/@adguard/agtree/dist/serializer/comment/comment-rule-serializer.js","npm/@adguard/agtree/dist/serializer/comment/agent-comment-serializer.js","npm/@adguard/agtree/dist/serializer/comment/agent-serializer.js","npm/@adguard/agtree/dist/serializer/misc/value-serializer.js","npm/@adguard/agtree/dist/serializer/comment/config-comment-serializer.js","npm/@adguard/agtree/dist/serializer/misc/parameter-list-serializer.js","npm/@adguard/agtree/dist/serializer/comment/hint-comment-serializer.js","npm/@adguard/agtree/dist/serializer/comment/hint-serializer.js","npm/@adguard/agtree/dist/serializer/comment/metadata-comment-serializer.js","npm/@adguard/agtree/dist/serializer/comment/pre-processor-comment-serializer.js","npm/@adguard/agtree/dist/serializer/comment/simple-comment-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/cosmetic-rule-serializer.js","npm/@adguard/agtree/dist/serializer/misc/domain-list-serializer.js","npm/@adguard/agtree/dist/serializer/misc/list-items-serializer.js","npm/@adguard/agtree/dist/serializer/misc/list-item-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/body/abp-snippet-injection-body-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/body/scriptlet-body-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/body/ubo-scriptlet-injection-body-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/body/adg-scriptlet-injection-body-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/element-hiding-body-serializer.js","npm/@adguard/agtree/dist/serializer/cosmetic/css-injection-body-serializer.js","npm/@adguard/agtree/dist/serializer/misc/modifier-list-serializer.js","npm/@adguard/agtree/dist/serializer/misc/modifier-serializer.js","npm/@adguard/agtree/dist/serializer/network/host-rule-serializer.js","npm/@adguard/agtree/dist/serializer/network/hostname-list-serializer.js","npm/@adguard/agtree/dist/serializer/network/network-rule-serializer.js","npm/@adguard/agtree/dist/serializer/empty-rule-serializer.js","npm/@adguard/agtree/dist/serializer/invalid-rule-serializer.js","npm/@adguard/agtree/dist/serializer/invalid-rule-error-node-serializer.js","npm/@ghostery/urlfilter2dnr/dist/esm/converters/helpers.js","npm/@ghostery/urlfilter2dnr/dist/esm/mappings.js"])))=>i.map(i=>d[i]);
import { __vitePreload } from '../virtual/preload-helper.js';

const DOCUMENT_PATH = 'pages/dnr-converter/index.html';

async function convert(filters) {
  let result;

  try {
    if (chrome.offscreen) {
      await setupOffscreenDocument();

      result = await chrome.runtime.sendMessage({
        action: 'dnr-converter:convert',
        filters,
      });
    } else {
      const { default: convertWithAdguard } = await __vitePreload(async () => { const { default: convertWithAdguard } = await import(
        '../npm/@ghostery/urlfilter2dnr/dist/esm/converters/adguard.js'
      );return { default: convertWithAdguard }},true              ?__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300]):void 0);
      result = await convertWithAdguard(filters, {
        resourcesPath: '/rule_resources/redirects',
      });

      result.errors = result.errors.map((e) => `DNR - ${e.message || e}`);
    }
  } catch (e) {
    return { errors: [e.message], rules: [] };
  } finally {
    if (chrome.offscreen) closeOffscreenDocument();
  }

  for (const [index, rule] of result.rules.entries()) {
    if (rule.condition.regexFilter) {
      const { isSupported, reason } =
        await chrome.declarativeNetRequest.isRegexSupported({
          regex: rule.condition.regexFilter,
        });

      if (!isSupported) {
        result.errors.push(
          `Could not apply a custom filter as "${rule.condition.regexFilter}" is a not supported regexp due to: ${reason}`,
        );
        result.rules.splice(index, 1);
      }
    }
  }

  return result;
}

let offscreenTimeout = null;
function closeOffscreenDocument() {
  if (offscreenTimeout) {
    clearTimeout(offscreenTimeout);
  }

  offscreenTimeout = setTimeout(() => {
    chrome.offscreen.closeDocument();
    offscreenTimeout = null;
  }, 1000);
}

async function setupOffscreenDocument() {
  if (offscreenTimeout) clearTimeout(offscreenTimeout);

  const offscreenUrl = chrome.runtime.getURL(DOCUMENT_PATH);
  const existingContexts = await chrome.runtime.getContexts({
    contextTypes: ['OFFSCREEN_DOCUMENT'],
    documentUrls: [offscreenUrl],
  });

  if (!existingContexts.length) {
    await chrome.offscreen.createDocument({
      url: DOCUMENT_PATH,
      reasons: [chrome.offscreen.Reason.IFRAME_SCRIPTING],
      justification: 'Convert network filters to DeclarativeNetRequest format.',
    });
  }
}

export { convert as default };
