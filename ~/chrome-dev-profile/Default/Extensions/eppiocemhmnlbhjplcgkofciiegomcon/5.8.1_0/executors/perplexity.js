(()=>{const j=(()=>{const j=sessionStorage.getItem("bis_data");if(null!==j){return JSON.parse(j)}return null})(),Z=j?.config?`${j.id}_t`:null,e=j?.config?.aiMessagesConfig?.PERPLEXITY||{},{PARSERS:u=[],CHATBOT_NAME:i=""}=e;ParserProcessors={XMLHttpRequest:function(j){const Z=fetch;fetch=async function(e,u={}){let i=e instanceof Request?e.url:e;if("object"==typeof i&&i.href&&(i=i.href),!(j=>{let Z=j.replace(/.*\/([gimy]*)$/,"$1"),e=j.replace(new RegExp("^/(.*?)/"+Z+"$"),"$1");return new RegExp(e,Z)})(j.QUERY).test(i))return Z.apply(this,arguments);try{const e=await Z.apply(this,arguments);return e.body instanceof ReadableStream&&setTimeout(M.bind(this,u,j,e.clone()),0),e}catch(j){return Z.apply(this,arguments)}}}};const M=async(j,Z,e)=>{const u=e.headers.get("Content-Type")||"";let i="",M="";try{u.includes("text/event-stream")&&(i=o(j.body,Z.SEND_MESSAGE)||"",M=await m(e.body,Z.RECEIVED_MESSAGE)||"")}catch(j){}finally{_(i,Z.SEND_MESSAGE?.MESSAGE_LIMIT||1e4,"user"),_(M,Z.RECEIVED_MESSAGE?.MESSAGE_LIMIT||3e4,"system")}},o=(j="{}",Z={})=>{const{MESSAGE_QUERY:e=[],ATTACHMENTS_QUERY:u=[],SOURCE_QUERY:i=[],IGNORED_SOURCES:M=[]}=Z;if(j){const Z=JSON.parse(j),o=w(i,Z)||"";if(M.includes(o))return"";let m=w(e,Z)||"";if(m){const j=w(u,Z)||[];j?.length&&j.forEach((j=>{j.includes(m)&&(m="")}))}return m}return""},m=async(j,Z={})=>{const{DATA_OBJ_QUERY:e=[],MESSAGE_QUERY:u=[]}=Z,i=j.getReader(),M=new TextDecoder("utf-8");let o="";for(;;){const{value:j,done:Z}=await i.read();if(Z)break;let m;for(o+=M.decode(j,{stream:!0}),o=o.replace(/\r\n/g,"\n");-1!==(m=o.indexOf("\n\n"));){const j=o.slice(0,m).trim();o=o.slice(m+2);const Z=j.split("\n"),i={};for(const j of Z){const[Z,...e]=j.split(":");if(Z&&e.length){const j=e.join(":").trim();if("data"===Z)try{i.data=JSON.parse(j)}catch{i.data=j}else i[Z]=j}}const M=w(e,i);if(M?.length){let j="";if(M.forEach((Z=>{const e=w(u,Z);e&&(j=e)})),j)return j}}}},w=(j,Z)=>j.reduce(((j,Z)=>j?"object"==typeof j?j[Z]:j:null),Z),_=(j,Z,e)=>{const u=self.location.href.split("-"),i=u[u.length-1];if(j&&i){const u=x(j,Z,i,e);u&&K(u)}},x=function(j,Z,e,u="user"){return{chatbotName:i,messageType:u,sessionId:e,messageId:"",messageLength:j.length,messageText:j.trim().slice(0,Z)}},K=j=>{try{let e={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"PERPLEXITY_DATA",from:Z,to:Z.substring(0,Z.length-2),content:j};window.postMessage(e)}catch(j){}};for(let j of u)j.USE&&ParserProcessors[j.TYPE](j)})();