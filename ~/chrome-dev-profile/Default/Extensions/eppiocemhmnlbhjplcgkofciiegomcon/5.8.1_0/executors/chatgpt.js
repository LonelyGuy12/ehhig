(()=>{const j=(()=>{const j=sessionStorage.getItem("bis_data");return null!==j?JSON.parse(j):null})(),Z=j?.config?`${j.id}_t`:null,e=j?.config?.aiMessagesConfig?.CHATGPT||{},{PARSERS:u=[],CHATBOT_NAME:i=""}=e,M=j=>{try{let e={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CHATGPT_DATA",from:Z,to:Z.substring(0,Z.length-2),content:j};window.postMessage(e)}catch(j){}},o=function(j,Z){let e={chatbotName:i};for(let u of Z)u.PATH?.length?e[u.NAME]=_.byPath(j,u.PATH):u.REDUCE_PARAMS&&(e[u.NAME]=_.byReduce(j,u.REDUCE_PARAMS));return e},m=function(j,Z){let e=j.messageText;"object"==typeof e&&e?.length&&(e=e.reduce(((j,Z)=>"object"==typeof Z?j:`${j} ${Z}`),"")),j.messageText=e.trim().slice(0,Z),j.messageLength=j.messageText.length},w=async function(j,Z,e){const u=Z.body.getReader(),i=new TextDecoder("utf-8");let w="",_=[],x="";try{for(;;){const{done:j,value:Z}=await u.read();if(j)break;w+=i.decode(Z,{stream:!0});let M=w.split("\n");for(let j=0;j<M.length;j++){const Z=M[j].trim();if(Z.startsWith("data:")&&e.RECEIVED_MESSAGE.INVALID_VALUES_TO_PARSE.some((j=>!Z.includes(j)))){const j=Z.slice(5).trim();try{_.push(JSON.parse(j))}catch(j){}}}x||(x=w.match(new RegExp(e.REGEXP_SESSION_ID_FROM_STREAM))?.groups?.sessionId),w=M[M.length-1]}}catch(j){}finally{!function(j,Z,e){if(j?.body?.length)try{let u=JSON.parse(j.body),i=o(u,e.RULES_GET_USER_VALUES);if(m(i,e.MESSAGE_LIMIT||1e4),!i||!i.messageText)return;i.sessionId||(i.sessionId=Z),i.messageType="user",setTimeout((()=>M(i)),0)}catch(j){}}(j,x,e.SENT_MESSAGE),function(j,Z,e){if(j?.length)try{let u=o(j,e.RULES_GET_SYSTEM_VALUES);if(!u||!u.messageText)return;u.sessionId||(u.sessionId=Z),u.messageType="system",m(u,e.MESSAGE_LIMIT||3e4),setTimeout((()=>M(u)),0)}catch(j){}}(_,x,e.RECEIVED_MESSAGE)}};ParserProcessors={XMLHttpRequest:function(j){const Z=self.fetch;self.fetch=async function(e,u={}){const i="string"==typeof e?e:e.url,M=u.method||"GET";try{const e=await Z.apply(this,arguments),o=e.clone();return e.ok&&e.body instanceof ReadableStream&&function(j,Z,e){return new RegExp(e.REGEXP_URL_CHECK).test(j)&&Z===e.REQUEST_METHOD}(i,M,j)&&setTimeout(w.bind(this,u,o,j),0),e}catch(j){return Z.apply(this,arguments)}}}};const _={byReduce:(j,Z)=>{const{KEY:e,CHECK_KEY:u,CHECK_VALUE:i,TYPE:M,RED_FLAG_PATH:o,RED_FLAG_VALUE:m,ALT_PATHS_TO_TEXT:w,ALT_TYPE:x,INVALID_TEXT_VALUES:K,FINISH_VALUE:C}=Z;if(o?.length)for(let Z of j){let j=Z;for(let Z=0;Z<o.length;Z++){const e=o[Z];if(!j[e]){j=null;break}j=j[e]}if(j===m)return null}return j.reduce(((j,Z,o,m)=>{if(!Z.hasOwnProperty(e))return j;if(Z[e]===C)return m.splice(o),j;if(typeof Z[e]===M)j+=Z[e];else if(typeof Z[e]===x&&!Array.isArray(Z[e]))for(let u of w){let i=_.byPath(Z[e],u);if(i===C){m.splice(o);break}i&&!K.includes(i)&&(j+=typeof i===M?i:i?.join(""))}if(Array.isArray(Z[e]))for(let w of Z[e]){if(w[e]===C){m.splice(o);break}w[u]===i&&w[e]&&typeof w[e]===M&&(j+=w[e])}return j}),"")},byPath:(j,Z)=>{for(let e=0;e<Z.length;e++){const u=Z[e];if(!j[u]){j=null;break}j=j[u]}return j}};!function(){for(let j of u)j.USE&&ParserProcessors[j.TYPE](j)}()})();