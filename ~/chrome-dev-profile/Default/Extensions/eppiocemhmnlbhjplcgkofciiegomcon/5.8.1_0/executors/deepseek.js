(()=>{const j=(()=>{const j=sessionStorage.getItem("bis_data");return null!==j?JSON.parse(j):null})(),Z=j?.config?`${j.id}_t`:null,e=j?.config?.aiMessagesConfig?.DEEPSEEK||{},{PARSERS:u=[],CHATBOT_NAME:i=""}=e,M=j=>{try{let e={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"DEEPSEEK_DATA",from:Z,to:Z.substring(0,Z.length-2),content:j};window.postMessage(e)}catch(j){}},o=function(j,Z){let e={chatbotName:i};for(let u of Z)u.PATH?.length?e[u.NAME]=_.byPath(j,u.PATH):u.REDUCE_PARAMS?e[u.NAME]=_.byReduce(j,u.REDUCE_PARAMS):u.CONSTANT_VALUE&&(e[u.NAME]=u.CONSTANT_VALUE);return e},m=function(j,Z){let e=j.messageText;j.messageText=e.trim().slice(0,Z),j.messageLength=e.length},w=async function(j,Z,e){let u=[],i="";try{let M=j.split("\n");for(let j=0;j<M.length;j++){const Z=M[j].trim();if(Z.startsWith("data:")){const j=Z.slice(5).trim();try{u.push(JSON.parse(j))}catch(j){}}}i=_.byPath(JSON.parse(Z),e.PATH_GET_SESSION_ID)}catch(j){}finally{!function(j,Z,e){if(j?.length)try{let u=JSON.parse(j),i=o(u,e.SENT_MESSAGE.RULES_GET_USER_VALUES);if(!i||!i.messageText)return;i.sessionId=Z,m(i,e.SENT_MESSAGE?.MESSAGE_LIMIT||1e4),setTimeout((()=>M(i)),0)}catch(j){}}(Z,i,e),function(j,Z,e){if(j?.length)try{let u=o(j,e.RECEIVED_MESSAGE.RULES_GET_SYSTEM_VALUES);if(!u||!u.messageText)return;u.sessionId=Z,m(u,e.RECEIVED_MESSAGE?.MESSAGE_LIMIT||3e4),setTimeout((()=>M(u)),0)}catch(j){}}(u,i,e)}};ParserProcessors={XMLHttpRequest:function(j){const Z=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(j,e){return this._requestMethod=j,this._requestUrl=e,Z.apply(this,arguments)},XMLHttpRequest.prototype.send=function(Z){let u=this.onreadystatechange;return this.onreadystatechange=function(){if(4===this.readyState&&function(j,Z,e){return new RegExp(e.REGEXP_URL_CHECK).test(j)&&Z===e.REQUEST_METHOD}(this._requestUrl,this._requestMethod,j)&&setTimeout(w.bind(this,this.responseText,Z,j),0),u)return u.apply(this,arguments)},e.apply(this,arguments)}}};const _={byReduce:(j,Z)=>{const{KEY:e,INVALID_VALUES:u,TYPE:i,RED_FLAG_PATH:M,RED_FLAG_VALUE:o}=Z;if(M?.length)for(let Z of j){let j=Z;for(let Z=0;Z<M.length;Z++){const e=M[Z];if(!j[e]){j=null;break}j=j[e]}if(j===o)return null}return j.reduce(((j,Z)=>(Z.hasOwnProperty(e)?typeof Z[e]===i&&u.some((j=>Z[e]!==j))&&(j+=Z[e]):j+="",j)),"")},byPath:(j,Z)=>{for(let e=0;e<Z.length;e++){const u=Z[e];if(!j[u]){j=null;break}j=j[u]}return j}};!function(){for(let j of u)j.USE&&ParserProcessors[j.TYPE](j)}()})();