(()=>{function j(){function j(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const Z=function(){let Z=sessionStorage.getItem("bis_data");if(null!==Z)return JSON.parse(Z);try{let Z={posdMessageId:"PANELOS_MESSAGE",posdHash:j(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage(Z)}catch(j){}return null}(),e=Z?Z.config.facebookConfig.videoDetectorConfigNew:null,u=Z?Z.id+"_w":null;const i="SCRIPT",M="XML_HTTP_REQUEST",o="INSTREAM_CONFIG",m="MARKETPLACE_VIDEO_AD",w="FEED_VIDEO_AD",_=function(j,Z,e="",u="",i="",M="",o="",m="",w="",_=""){return{detectionTime:Date.now()/1e3|0,videoId:j,videoUrl:Z,previewImageUrl:u,audioUrl:e,linkDisplay:i,userName:M,adName:o,adLogo:m,videoResolutionId:w,audioResolutionId:_}},x=function(j,Z){const e=new RegExp(Z,"i"),u=j.match(e),i=Z.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!u)return"";if(u.groups&&i)return 0===u.groups[i].search(/"/)?u.groups[i].replace(/"/,""):u.groups[i];let M=u.filter((j=>j));return!!M[1]&&M[1]},K=function(j,Z){try{let e=Z.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const u=j.CHECKER;e=e.filter((j=>u.some((Z=>new RegExp(Z).test(j)))));const i=[];if(e.length){for(let Z of e){let e=Z;"string"==typeof Z&&(e=JSON.parse(Z));const u=A(e,j),M=y(e,j),o=V(e,j),m=P(e,j.PATH_USER_NAME),w=P(e,j.PATH_VIDEO_REPRESENTATION_ID,parseInt(o)),x=P(e,j.PATH_AUDIO_REPRESENTATION_ID,parseInt(o)),K=_(o,u,"",M,"",m,"","",w,x);o&&u&&i.push(K)}i.forEach((j=>{setTimeout(b(j,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(j){}},C=function(j,Z,e){let u=[];const i=[];try{u.push(JSON.parse(Z)),setTimeout(b({url:e,requestMethod:"POST",content:u},"FACEBOOK_INSTREAM_DATA"),0)}catch(M){u=Z.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),u.forEach((Z=>{if(Z.length<=3||!j.CHECKER.some((j=>Z.includes(j))))return;let e=JSON.parse(Z),u=e,M=e;for(let Z of j.PATH_NODES){const e=j.PATH_NODES.indexOf(Z),M=j.PATH_NODES.length-1;e!==M&&u[Z]&&(u=u[Z]),e===M&&u[Z]&&(u=u[Z],u.length?u.forEach((Z=>{Z.bisLinks={aboutPageLink:W(Z,j.PATH_USER_ID)},Z.video_id=$(Z,j.PATH_VIDEO_ID),i.push(Z)})):(u.bisLinks={aboutPageLink:W(u,j.PATH_USER_ID)},u.video_id=$(u,j.PATH_VIDEO_ID),i.push(u)))}for(let Z of j.PATH_ALL_VIDEO){const e=j.PATH_ALL_VIDEO.indexOf(Z),u=j.PATH_ALL_VIDEO.length-1;if(e!==u&&M[Z]&&(M=M[Z]),"string"!=typeof Z&&e===u&&Z.length)if(M.length)M.forEach(((j,e)=>{const u=i[e];if(u.video_id===j.video_id)for(let e of Z)if(j[e]){u[e]=j[e];break}}));else if(1===i.length){const j=i[0];if(j.video_id===M.video_id)for(let e of Z)if(M[e]){j[e]=M[e];break}}}})),i.forEach((j=>{setTimeout(b({url:e,requestMethod:"POST",content:j},"FACEBOOK_INSTREAM_DATA"),0)}))}},$=function(j,Z){let e=j,u=null;for(let j of Z){const i=Z.indexOf(j),M=Z.length-1;i!==M&&e[j]&&(e=e[j]),i===M&&e[j]&&(u=e[j])}return parseInt(u,10)},W=function(j,Z){let e=j,u=null;for(let j of Z){const i=Z.indexOf(j),M=Z.length-1;i!==M&&e[j]&&(e=e[j]),i===M&&e[j]&&(u=`https://www.facebook.com/${e[j]}/about`)}return u},a=function(j,Z){Z=Z.replace(/ /g,"");const u=x(Z,j.VIDEO_ID);if(!u)return;let i=null,M=null,o="",m="",w="",K="",C="";j.VIDEO_HD_URL&&(i=x(Z,j.VIDEO_HD_URL)),j.VIDEO_SD_URL&&!i&&(M=x(Z,j.VIDEO_SD_URL)),j.LINK_DISPLAY&&(w=x(Z,j.LINK_DISPLAY)),e.VIDEO_AUDIO_URL&&(o=x(Z,j.VIDEO_AUDIO_URL),o=o?o.split("\\").join(""):o),j.THUMBNAIL&&(m=x(Z,j.THUMBNAIL),m=m?m.split("\\").join(""):m),j.VIDEO_REPRESENTATION_ID&&(K=x(Z,j.VIDEO_REPRESENTATION_ID)),j.AUDIO_REPRESENTATION_ID&&(C=x(Z,j.AUDIO_REPRESENTATION_ID));let $=i||M;if($){$=$.split("\\").join("");const j=_(u,$,o,m,w,"","","",K,C);setTimeout(b(j,"FACEBOOK_VIDEO_DATA"),0)}},g=function(j,Z){try{let e=Z.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const u=j.CHECKER;e=e.filter((j=>u.some((Z=>new RegExp(Z).test(j)))));const i=[];if(e.length){for(let Z of e){let e=Z;"string"==typeof Z&&(e=JSON.parse(Z));const u=l(e,j),M=A(e,j),o=y(e,j),m=V(e,j),w=P(e,j.PATH_NAME),x=P(e,j.PATH_LOGO),K=P(e,j.PATH_VIDEO_REPRESENTATION_ID,parseInt(m)),C=P(e,j.PATH_AUDIO_REPRESENTATION_ID,parseInt(m)),$=_(m,M,u,o,"","",w,x,K,C);m&&M&&i.push($)}i.forEach((j=>{setTimeout(b(j,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(j){}},P=function(j,Z,e=null){let u="";for(const i of Z){const Z=i.length;let M=j;for(let j=0;j<Z;j++){const o=i[j],m=Z-1;if("*"===o&&e){if([M]=M.filter((j=>e===parseInt(j.video_id))),!M)break}else if(o<0)M=M.slice(o,M.length)[0];else{if(!M[o])break;if(j===m){u=M[o];break}j!==m&&(M=M[o])}}}return u},l=function(j,Z){let e="";for(const u of Z.PATH_AUDIO_URL){const Z=u.length;let i=j;for(let j=0;j<Z;j++){const M=u[j],o=Z-1;if(!i[M])break;j!==o&&i[M]&&(i=i[M]),j===o&&i[M]&&(e=i[M])}}return e},A=function(j,Z){let e=null;for(const u of Z.PATH_VIDEO_URL){const Z=u.length;let i=j;for(let j=0;j<Z;j++){const M=u[j],o=Z-1;if(!i[M]&&M.includes&&!M.includes("%%%"))break;if(j!==o&&i[M]&&(i=i[M]),M.includes&&M.includes("%%%")){let[Z,u]=M.split("%%%");if(i[Z]||i[u]){if(j===o){e=i[Z]?i[Z]:i[u];break}i=i[Z]?i[Z]:i[u]}}j===o&&i[M]&&(e=i[M])}}return e},y=function(j,Z){let e=null;for(const u of Z.PATH_THUMBNAIL){const Z=u.length;let i=j;for(let j=0;j<Z;j++){const M=u[j],o=Z-1;if(!i[M])break;j!==o&&i[M]&&(i=i[M]),j===o&&i[M]&&(e=i[M])}}return e},V=function(j,Z){let e=null;for(const u of Z.PATH_VIDEO_ID){const Z=u.length;let i=j;for(let j=0;j<Z;j++){const M=u[j],o=Z-1;if(!i[M])break;j!==o&&i[M]&&(i=i[M]),j===o&&i[M]&&(e=i[M])}}return e},T=function(j,Z,u=null){const i=function(j,Z){Z=String(Z);const u=e.PARSER_CONFIG[j];return u.SEPARATOR?Z.split(u.SEPARATOR):[Z]}(Z,j);i.forEach((j=>{setTimeout((()=>function(j,Z=null,u=null){const i=Z?e.PARSERS.filter((j=>j.TYPE===Z)):e.PARSERS;for(const e of i)if(e.CHECKER.some((Z=>j.includes(Z))))try{switch(Z){case o:setTimeout((()=>C(e,j,u)),0);break;case m:setTimeout((()=>g(e,j,u)),0);break;case w:setTimeout((()=>K(e,j,u)),0);break;default:setTimeout((()=>a(e,j)),0)}}catch(j){}}(j,Z,u)),0)}))},b=function(Z,e){return function(){!function(Z,e,u){let i;try{i={posdMessageId:"PANELOS_MESSAGE",posdHash:j(),type:u,from:Z,to:Z.substring(0,Z.length-2),content:e},window.postMessage(i)}catch(j){}}(u,Z,e)}};if(e?.PARSER_CONFIG.SCRIPT.USE){const j=function(){const j=document.querySelectorAll("script");for(const Z of j)Z.hasAttribute("bis_use")||(Z.setAttribute("bis_use","true"),T(Z.innerHTML,i))};j(),setInterval(j,e.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(e?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let j=XMLHttpRequest.prototype.open,Z=XMLHttpRequest.prototype.setRequestHeader,u=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const j=arguments[0].toLowerCase(),e=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[j]=e,Z.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],j.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let j=this.onreadystatechange;return this.onreadystatechange=function(){const Z=e.MATCH_URLS,u=e.MATCH_HEADERS,i=this.requestHeaders?Object.keys(this.requestHeaders):null,_=e.PARSER_CONFIG.INSTREAM_CONFIG,x=e.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,K=e.PARSER_CONFIG.FEED_VIDEO_AD;let C=!1,$=null,W=null;if(i&&(C=i.some((j=>{if(u[j]&&u[j].includes(this.requestHeaders[j]))return $=j,W=this.requestHeaders[j],!0}))),4===this.readyState&&Z.filter((j=>j.indexOf(this.responseURL))).length>0)if(C)switch(!0){case _.USE&&_.HEADERS[$].includes(W):setTimeout((()=>T(this.response,o,this.responseURL)),0);break;case x.USE&&x.HEADERS[$].includes(W):setTimeout((()=>T(this.response,m,this.responseURL)),0);break;case K.USE&&K.HEADERS[$].includes(W):setTimeout((()=>T(this.response,w,this.responseURL)),0)}else setTimeout((()=>T(this.response,M)),0);if(j)return j.apply(this,arguments)},u.apply(this,arguments)}}}j(),window.addEventListener("message",(Z=>{switch(Z.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void j();case"FACEBOOK_CANVAS_TEXT":let e=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),u=null,i=Z.data.content.attribute;const M=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let j of e){if(!Object.entries(j).some((j=>{if(j[0].search(/reactFiber/)>=0)return u=j[0],!0})))return void j.setAttribute(i,"");let Z=j[u];for(let j of M)Z[j]&&(Z=Z[j]);j.setAttribute(i,Z)}}}))})();