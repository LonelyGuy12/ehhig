(()=>{const j=(()=>{const j=sessionStorage.getItem("bis_data");if(null!==j){return JSON.parse(j)}return null})(),Z=j?.config?`${j.id}_t`:null,e=j?.config?.aiMessagesConfig?.META_AI||{},{PARSERS:u=[],CHATBOT_NAME:i=""}=e;ParserProcessors={XMLHttpRequest:function(j){let Z=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(...e){const u=e[0],i=this;return i.addEventListener("readystatechange",(function(){if(4===i.readyState&&i.status>=200&&i.status<300){const{message:Z,sessionId:e}=M(u,j.SEND_MESSAGE);Z&&e&&o(i.responseText,j.RECEIVED_MESSAGE,e)}})),Z.call(this,...e)}}};const M=(j,Z)=>{const{MESSAGE_LIMIT:e=1e4,DATA_QUERY:u="",MESSAGE_QUERY:i=[],SESSION_ID_QUERY:M=[]}=Z;let o=null,_=null;if("string"==typeof j&&j.includes(`${u}=`)){o=new URLSearchParams(j).get(u)}if(j instanceof FormData&&(o=j.get(u)),o)try{_=JSON.parse(o)}catch(j){}if(_){const j=m(i,_),Z=m(M,_);if(Z&&j)return w(j,e,Z),{message:j,sessionId:Z}}return{}},o=(j,Z,e)=>{try{const{MESSAGE_LIMIT:u=3e4,DATA_FILTER:i="",MESSAGE_QUERY:M=[]}=Z,o=j.split("\n").filter((j=>j.trim().startsWith(i))),_=o[o.length-1],x=JSON.parse(_),K=m(M,x);K&&w(K,u,e,"system")}catch(j){}},m=(j,Z)=>j.reduce(((j,Z)=>j?"object"==typeof j?j[Z]:j:null),Z),w=(j,Z,e,u)=>{if(e&&j){const i=_(j,Z,e,u);i&&x(i)}},_=function(j,Z,e,u="user"){return{chatbotName:i,messageType:u,sessionId:e,messageLength:j.length,messageText:j.trim().slice(0,Z)}},x=j=>{try{let e={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"META_AI_DATA",from:Z,to:Z.substring(0,Z.length-2),content:j};window.postMessage(e)}catch(j){}};for(let j of u)j.USE&&ParserProcessors[j.TYPE](j)})();