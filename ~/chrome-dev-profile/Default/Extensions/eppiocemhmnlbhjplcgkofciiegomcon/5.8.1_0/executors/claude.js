(()=>{const j=(()=>{const j=sessionStorage.getItem("bis_data");if(null!==j){return JSON.parse(j)}return null})(),Z=j?.config?`${j.id}_t`:null,e=j?.config?.aiMessagesConfig?.CLAUDE||{},{PARSERS:u=[],CHATBOT_NAME:i=""}=e;ParserProcessors={XMLHttpRequest:function(j){const Z=fetch,e=j=>{let Z=j.replace(/.*\/([gimy]*)$/,"$1"),e=j.replace(new RegExp("^/(.*?)/"+Z+"$"),"$1");return new RegExp(e,Z)};fetch=async function(u,i={}){let m=u instanceof Request?u.url:u;"object"==typeof m&&m.href&&(m=m.href);const w=e(j.QUERY).test(m),_=e(j.RETRY_QUERY).test(m);if(!w&&!_)return Z.apply(this,arguments);try{const e=await Z.apply(this,arguments);if(e.body instanceof ReadableStream){const Z=e.clone(),u=Z.headers.get("Content-Type")||"",{body:w}=i;w&&u.includes("text/event-stream")&&(_||M(w,m,j.SEND_MESSAGE),setTimeout(o.bind(this,Z,m,j.RECEIVED_MESSAGE),0))}return e}catch(j){return Z.apply(this,arguments)}}}};const M=(j,Z,e)=>{const{MESSAGE_LIMIT:u=1e4,CONTENT_QUERY:i=[]}=e;if(!j)return"";try{const e=JSON.parse(j),M=m(i,e);M&&w(M,u,Z)}catch(j){}},o=async(j,Z,e)=>{const{MESSAGE_LIMIT:u=[],LINE_START_QUERY:i="",CONTENT_TYPE:M,TEXT_PART_QUERY:o=[]}=e,_=j.body.getReader(),x=new TextDecoder("utf-8");let K="",C="";try{for(;;){const{done:j,value:Z}=await _.read();if(j)break;K+=x.decode(Z,{stream:!0});const e=K.split("\n");K=e.pop();for(let j of e)if(j.startsWith(i))try{const Z=JSON.parse(j.slice(i.length));Z.type===M&&"string"==typeof m(o,Z)&&(C+=m(o,Z))}catch(j){}}w(C,u,Z,"system")}catch(j){}},m=(j,Z)=>j.reduce(((j,Z)=>j?"object"==typeof j?j[Z]:j:null),Z),w=(j,Z,e,u)=>{const i=e.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),M=i?.[1];if(M&&j){const e=_(j,Z,M,u);e&&x(e)}},_=function(j,Z,e,u="user"){return{chatbotName:i,messageType:u,sessionId:e,messageId:"",messageLength:j.length,messageText:j.trim().slice(0,Z)}},x=j=>{try{let e={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:Z,to:Z.substring(0,Z.length-2),content:j};window.postMessage(e)}catch(j){}};for(let j of u)j.USE&&ParserProcessors[j.TYPE](j)})();